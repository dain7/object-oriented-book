# 챕터 04: 역할, 책임, 협력

## 📚 핵심 내용 요약

인간의 행동을 정하는 것은 인간의 어떤 본질적인 특성 때문이 아니라 어떤 상황에 처해있느냐임.
각 개인이 처해 있는 정황 또는 문맥이 인간의 행동방식을 결정함 => 인간의 행동을 결정하는 문맥은 타인의 협력

- 최후 통첩 게임 (제안자가 돈의 비율을 정하고 응답자가 그것을 받아들이느냐 마느냐 정함)

마찬가지로 객체의 시계에서도 협력이라는 문맥이 객체의 행동 방식을 결정함

### 협력

협력은 한 사람이 다른 사람에게 도움을 요청할 때 시작된다. 요청을 받은 사람을 일을 처리한 후 요청한 사람에게 필요한 지식이나 서비스를 제공하는 것으로 요청에 응답한다 => 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다

예를 들어 '파이를 훔친 하트 잭에 대한 공판이 열리고 있는 법정의 모습'을 상상해 볼 때

- 재판을 주관하고 있는 왕
- 증언을 하는 모자 장수
- 재판을 구경하기 위해 법정을 찾은 앨리스
  => 이들 모두 하트 잭의 재판이라는 동일한 목적을 달성하기 위해 협력하고 있다.

왕에게 재판을 해달라는 요청을 보냈다 -> 왕이 재판을 수행할 의무가 있다
왕이 하얀 토끼에게 목격자를 불러오라고 했다 -> 토끼가 목격자에 대해 알고 있으며 목격자를 부를 의무가 있다

결국 등장인물들이 특정한 요청을 받아들일 수 있는 이유는 그 요청에 대해 적절한 방식으로 응답하는데 필요한 지식과 행동 방식을 가지고 있기 때문이다. 요청과 응답을 협력에 참여하는 객체가 수행할 책임을 정의한다.

### 책임

객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해줄 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 **책임**을 진다고 말한다.

협력에 참여하는 객체들은 목표를 달성하는데 필요한 책임을 수행한다. 책임은 객체에 의해 정의되는 응집도 있는 행위의 집합으로 객체가 알아야하는 정보와 객체가 수행할 수 있는 행위에 대해 개략적으로 서술한 문장이다.

**하는 것**

- 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
- 다른 객체의 행동을 시작시키는 것
- 다른 객체의 활동을 제어하고 조절하는 것

**아는 것**

- 개인적인 정보에 관해 아는 것
- 관련된 객체에 관해 아는 것
- 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

책임은 객체지향 설계의 품질을 결정하는 가장 중요한 요소다. 책임은 객체의 외부에 제공해줄 수 있는 정보와 외부에 제공해줄 수 있는 서비스의 목록이다. 따라서 책임은 객체의 공용 인터페이스를 구성한다.

##### 책임과 메세지

두 객체 간의 협력은 메세지를 통해 이뤄진다. 메세지를 전송함으로써 협력을 요청하는 객체를 송신자라고 하고 메세지를 받아 요청을 처리하는 객체를 수신자라고 한다.

그러나 책임과 메세지의 수준이 같지는 않다. 책임은 객체가 협력에 참여하기 위해 수행해야 하는 행위를 상위 수준에서 개략적으로 서술한 것이다. 책임을 결정한 후 실제로 협력을 정제하면서 이를 메세지로 변환할 때는 하나의 책임이 여러 메세지로 분할되는 것이 일반적이다.

### 역할

모자 장수가 재판이라는 협력 안에서 '증인석에 입장한다'와 '증언한다'라는 책임을 가진다는 것은 -> 증인이라는 역할 수행중
왕이 '재판한다'라는 책임을 지고 하얀 토끼에게 목격자를 불러오도록 요청한는 것은? -> 판사라는 역할 수행중

객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다.
근데 이게 중요할까? 왕은 왕인데 왜 판사라고 굳이 부를까 => 역할은 재사용이 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소이기 때문이다.

판사는 왕이 할수도, 여왕이 할수도 있고, 증인은 모자 장수가 할수도, 토끼가 할수도 있다!

재판이라는 협력 과정 속에서 하트 왕과 하트 여왕은 '판사'의 역할을 수행한다.
모자 장수와 요리사, 그리고 앨리스는 '증인'의 역할을 수행한다. 따라서 '판사'와 '증인'이라는 역할을 사용하면 세가지 협력을 모두 포괄할 수 있는 하나의 협력으로 추상화할 수 있다.

역할은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식이다!
역할을 대체하기 위해서는 각 역할이 수신할 수 있는 메세지를 동일한 방식으로 이해해야 한다.
하트 왕이 판사의 역할을 수행할 수 있는 이유는 판사가 수신할 수 있는 '재판하라'라는 메세지를 동일하게 이해하고 처리할 수 있기 때문이다. => 역할을 대체할 수 있는 객체는 동일한 메세지를 이해할 수 있는 객체로 한정된다

역할은 객체지향 설계의 단순성, 유연성, 재사용성을 뒷받침하는 핵심 개념이다!

### 객체의 모양을 결정하는 협력

객체지향에서 중요한 것은 정적인 클래스가 아니라 협력에 참여하는 동적인 객체이며, 클래스는 단지 시스템에 필요한 객체를 표현하고 생성하기 위해 프로그래밍 언어가 제공하는 구현 메커니즘이라는 사실이다!

협력을 설계한다는 것은 설계에 참여하는 객체들이 주고받을 요청과 응답의 흐름을 결정한다는 것을 의미한다.

책임은 객체가 외부에 제공하게 될 행동이 된다. 협력이라는 문맥에서 객체가 수행하게 될 적절한 책임, 즉 행동을 결정한 후에 그 행동을 수행하는데 필요한 데이터를 고민해야 한다. 객체가 협력에 참여하기 위해 필요한 데이터와 행동이 어느정도 결정된 후에 클래스의 구현 방법을 결정해야 한다.

객체지향이 올바른 객체에 올바른 책임을 할당하는 것과 관련된 모든 것이라면 협력이라는 문맥 안에서 객체를 생각하는 것은 올바른 객체지향 애플리케이션을 구현하는 것과 관련된 모든 것이다.

### 객체지향 설계 기법

**책임 주도 설계**

- 시스템의 기능은 더 작은 규모의 책임으로 분할되고 각 책임을 책임을 수행할 적절한 객체에게 할당된다.
- 시스템의 책임을 객체의 책임으로 변환하고, 각 객체가 책임을 수행하는 중에 필요한 정보나 서비스를 제공해줄 협력자를 찾아 해당 협력자에게 책임을 할당하는 순차적인 방식으로 객체들의 협력 공동체를 구축한다.

**디자인 패턴**

- 디자인 패턴은 반복적으로 발생하는 문제와 그 문제에 대한 해법의 쌍으로 정의된다.
- 디자인 패턴의 구성 요소와 클래스가 메서드가 아니라 '협력'에 참여하는 '역할'과 '책임'이라는 사실이 중요하다!

**테스트 주도 개발**
테스트 주도 개발은 객체가 이미 존재한다고 가정하고 객체에게 어떤 메세지를 전송할 것인지에 관해 먼저 생각하라고 충고한다.
그러나 이같은 종류의 충고는 역할, 책임, 협력의 관점에서 객체를 바라보지 않을 경우 무의미하다.

테스트 주도 개발은 테스트를 작성하는 것이 아니라 책임을 수행할 객체 또는 클아이언트가 기대하는 객체의 역할이 메세지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것이다.

## 🤔 내 생각 및 질문

같은 행동을 수행하는 객체들이 같은 '역할'을 갖는다! 이게 어떤 개념인지 확 와닿았다.
나는 평소 객체를 설계할 떄 '비슷한 데이터'를 가진 객체들을 같은 묶음으로 이해하고 있엇는데 '행동'이 중요하다는 것!

## 💡 적용 및 실천 아이디어

**객체지향을 잘 나타내는 디자인패턴 예시**

- 전략패턴
  - 같은 행동, 같은 역할(=지불하다)을 가짐, 대체할 수 있음!

```kotlin
interface PaymentStrategy {
    fun pay(amount: Int)
}

class KakaoPay : PaymentStrategy {
    override fun pay(amount: Int) = println("카카오페이로 $amount 원 결제")
}

class TossPay : PaymentStrategy {
    override fun pay(amount: Int) = println("토스로 $amount 원 결제")
}

class PaymentProcessor(private val strategy: PaymentStrategy) {
    fun process(amount: Int) = strategy.pay(amount)
}
```
